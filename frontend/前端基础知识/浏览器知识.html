<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器知识 | 火龙果文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/plugin/images/common/logo.png">
    <meta name="description" content="Karl_fang文档笔记">
    
    <link rel="preload" href="/plugin/assets/css/0.styles.c8de49fe.css" as="style"><link rel="preload" href="/plugin/assets/js/app.c9215cbb.js" as="script"><link rel="preload" href="/plugin/assets/js/2.3109c390.js" as="script"><link rel="preload" href="/plugin/assets/js/60.f66cea3f.js" as="script"><link rel="preload" href="/plugin/assets/js/4.e3ff3068.js" as="script"><link rel="prefetch" href="/plugin/assets/js/10.715ea178.js"><link rel="prefetch" href="/plugin/assets/js/11.1649de93.js"><link rel="prefetch" href="/plugin/assets/js/12.1a357012.js"><link rel="prefetch" href="/plugin/assets/js/13.ad0621a5.js"><link rel="prefetch" href="/plugin/assets/js/14.f836128c.js"><link rel="prefetch" href="/plugin/assets/js/15.185d9a57.js"><link rel="prefetch" href="/plugin/assets/js/16.5f33fe72.js"><link rel="prefetch" href="/plugin/assets/js/17.0af46bc3.js"><link rel="prefetch" href="/plugin/assets/js/18.7c734243.js"><link rel="prefetch" href="/plugin/assets/js/19.a674ca8c.js"><link rel="prefetch" href="/plugin/assets/js/20.c8a0e68e.js"><link rel="prefetch" href="/plugin/assets/js/21.1838a778.js"><link rel="prefetch" href="/plugin/assets/js/22.1d02d7b4.js"><link rel="prefetch" href="/plugin/assets/js/23.97f8bc82.js"><link rel="prefetch" href="/plugin/assets/js/24.6d98aa5d.js"><link rel="prefetch" href="/plugin/assets/js/25.ef08796f.js"><link rel="prefetch" href="/plugin/assets/js/26.6908e271.js"><link rel="prefetch" href="/plugin/assets/js/27.61ec64cf.js"><link rel="prefetch" href="/plugin/assets/js/28.52f425d6.js"><link rel="prefetch" href="/plugin/assets/js/29.14e98a0d.js"><link rel="prefetch" href="/plugin/assets/js/3.b173f1f9.js"><link rel="prefetch" href="/plugin/assets/js/30.ed93fd03.js"><link rel="prefetch" href="/plugin/assets/js/31.d0a61d46.js"><link rel="prefetch" href="/plugin/assets/js/32.82c2f807.js"><link rel="prefetch" href="/plugin/assets/js/33.f42860e9.js"><link rel="prefetch" href="/plugin/assets/js/34.cfdbf446.js"><link rel="prefetch" href="/plugin/assets/js/35.5567dd2e.js"><link rel="prefetch" href="/plugin/assets/js/36.2c3a284d.js"><link rel="prefetch" href="/plugin/assets/js/37.0096902c.js"><link rel="prefetch" href="/plugin/assets/js/38.13bedfd6.js"><link rel="prefetch" href="/plugin/assets/js/39.d25b0d78.js"><link rel="prefetch" href="/plugin/assets/js/40.65184eba.js"><link rel="prefetch" href="/plugin/assets/js/41.79db90da.js"><link rel="prefetch" href="/plugin/assets/js/42.c72d5e7a.js"><link rel="prefetch" href="/plugin/assets/js/43.68007c4a.js"><link rel="prefetch" href="/plugin/assets/js/44.894b417a.js"><link rel="prefetch" href="/plugin/assets/js/45.229d6844.js"><link rel="prefetch" href="/plugin/assets/js/46.53f2f813.js"><link rel="prefetch" href="/plugin/assets/js/47.a2a431fd.js"><link rel="prefetch" href="/plugin/assets/js/48.09bd3496.js"><link rel="prefetch" href="/plugin/assets/js/49.c18fe647.js"><link rel="prefetch" href="/plugin/assets/js/5.33a91e62.js"><link rel="prefetch" href="/plugin/assets/js/50.fbb4d2d9.js"><link rel="prefetch" href="/plugin/assets/js/51.bcb814f9.js"><link rel="prefetch" href="/plugin/assets/js/52.b05b586d.js"><link rel="prefetch" href="/plugin/assets/js/53.23ca139c.js"><link rel="prefetch" href="/plugin/assets/js/54.ebf744d3.js"><link rel="prefetch" href="/plugin/assets/js/55.a7edfe51.js"><link rel="prefetch" href="/plugin/assets/js/56.121fecb8.js"><link rel="prefetch" href="/plugin/assets/js/57.a480788d.js"><link rel="prefetch" href="/plugin/assets/js/58.1a3b2a75.js"><link rel="prefetch" href="/plugin/assets/js/59.686deecb.js"><link rel="prefetch" href="/plugin/assets/js/6.3d2691df.js"><link rel="prefetch" href="/plugin/assets/js/61.4a0d7b33.js"><link rel="prefetch" href="/plugin/assets/js/62.d5dfd7bf.js"><link rel="prefetch" href="/plugin/assets/js/63.6b039783.js"><link rel="prefetch" href="/plugin/assets/js/64.6158e3d4.js"><link rel="prefetch" href="/plugin/assets/js/65.77586fa0.js"><link rel="prefetch" href="/plugin/assets/js/66.6a8b2478.js"><link rel="prefetch" href="/plugin/assets/js/67.613c0700.js"><link rel="prefetch" href="/plugin/assets/js/68.f7a526b0.js"><link rel="prefetch" href="/plugin/assets/js/69.7b3e9222.js"><link rel="prefetch" href="/plugin/assets/js/7.290b946a.js"><link rel="prefetch" href="/plugin/assets/js/70.04085217.js"><link rel="prefetch" href="/plugin/assets/js/71.64781db8.js"><link rel="prefetch" href="/plugin/assets/js/72.7d99109d.js"><link rel="prefetch" href="/plugin/assets/js/73.f0d93e31.js"><link rel="prefetch" href="/plugin/assets/js/74.2a506453.js"><link rel="prefetch" href="/plugin/assets/js/75.e546d16c.js"><link rel="prefetch" href="/plugin/assets/js/76.d8196960.js"><link rel="prefetch" href="/plugin/assets/js/77.02184b57.js"><link rel="prefetch" href="/plugin/assets/js/78.263fc9c7.js"><link rel="prefetch" href="/plugin/assets/js/79.eea88991.js"><link rel="prefetch" href="/plugin/assets/js/8.9e3cfa8b.js"><link rel="prefetch" href="/plugin/assets/js/80.59166ecf.js"><link rel="prefetch" href="/plugin/assets/js/81.4b332e84.js"><link rel="prefetch" href="/plugin/assets/js/82.ab6702af.js"><link rel="prefetch" href="/plugin/assets/js/83.d5273ee4.js"><link rel="prefetch" href="/plugin/assets/js/9.0fcbcb20.js">
    <link rel="stylesheet" href="/plugin/assets/css/0.styles.c8de49fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/plugin/" class="home-link router-link-active"><img src="/plugin/images/common/logo.png" alt="火龙果文档" class="logo"> <span class="site-name can-hide">火龙果文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/plugin/" class="nav-link">
    主页
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="导航" class="dropdown-title"><span class="title">导航</span> <span class="arrow down"></span></button> <button type="button" aria-label="导航" class="mobile-dropdown-title"><span class="title">导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            其他
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/help/emoji.html" class="nav-link">
    Emoji
  </a></li></ul></li><li class="dropdown-item"><h4>
            Manifest V3
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/guide/V3的配置更改.html" class="nav-link">
    V3的配置更改
  </a></li><li class="dropdown-subitem"><a href="/plugin/guide/V3的manifest.html" class="nav-link">
    V3的manifest
  </a></li><li class="dropdown-subitem"><a href="/plugin/help/declarePermission.html" class="nav-link">
    权限声明
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            插件
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/plugin/前言.html" class="nav-link">
    前言
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/myDevTool.html" class="nav-link">
    myDevTool
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/myNewTab.html" class="nav-link">
    myNewTab
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/Pitaya.html" class="nav-link">
    Pitaya
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/progress.html" class="nav-link">
    progress
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/chatgpt.html" class="nav-link">
    chatgpt-theme
  </a></li></ul></li><li class="dropdown-item"><h4>
            NPM库
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/npm/mylibs.html" class="nav-link">
    @karl_fang/mylibs
  </a></li><li class="dropdown-subitem"><a href="/plugin/npm/js数据结构.html" class="nav-link">
    @karl_fang/data-structure
  </a></li></ul></li><li class="dropdown-item"><h4>
            脚手架工具
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/guide/karl-cli.html" class="nav-link">
    karl-cli
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            Vue笔记系列
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(1).html" class="nav-link">
    Vue(1)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(2).html" class="nav-link">
    Vue(2)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(3).html" class="nav-link">
    Vue(3)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(4).html" class="nav-link">
    Vue(4)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(5).html" class="nav-link">
    Vue(5)
  </a></li></ul></li><li class="dropdown-item"><h4>
            Vue 手写系列
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue-defineReactive.html" class="nav-link">
    Vue 响应式原理
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue-template.html" class="nav-link">
    Vue 模板编译
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow down"></span></button> <button type="button" aria-label="小程序" class="mobile-dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/plugin/weChat/Pitaya-Hut.html" class="nav-link">
    Pitaya Hut
  </a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ox4f5da2" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/plugin/" class="nav-link">
    主页
  </a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="导航" class="dropdown-title"><span class="title">导航</span> <span class="arrow down"></span></button> <button type="button" aria-label="导航" class="mobile-dropdown-title"><span class="title">导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            其他
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/help/emoji.html" class="nav-link">
    Emoji
  </a></li></ul></li><li class="dropdown-item"><h4>
            Manifest V3
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/guide/V3的配置更改.html" class="nav-link">
    V3的配置更改
  </a></li><li class="dropdown-subitem"><a href="/plugin/guide/V3的manifest.html" class="nav-link">
    V3的manifest
  </a></li><li class="dropdown-subitem"><a href="/plugin/help/declarePermission.html" class="nav-link">
    权限声明
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            插件
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/plugin/前言.html" class="nav-link">
    前言
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/myDevTool.html" class="nav-link">
    myDevTool
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/myNewTab.html" class="nav-link">
    myNewTab
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/Pitaya.html" class="nav-link">
    Pitaya
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/progress.html" class="nav-link">
    progress
  </a></li><li class="dropdown-subitem"><a href="/plugin/plugin/chatgpt.html" class="nav-link">
    chatgpt-theme
  </a></li></ul></li><li class="dropdown-item"><h4>
            NPM库
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/npm/mylibs.html" class="nav-link">
    @karl_fang/mylibs
  </a></li><li class="dropdown-subitem"><a href="/plugin/npm/js数据结构.html" class="nav-link">
    @karl_fang/data-structure
  </a></li></ul></li><li class="dropdown-item"><h4>
            脚手架工具
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/guide/karl-cli.html" class="nav-link">
    karl-cli
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
            Vue笔记系列
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(1).html" class="nav-link">
    Vue(1)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(2).html" class="nav-link">
    Vue(2)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(3).html" class="nav-link">
    Vue(3)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(4).html" class="nav-link">
    Vue(4)
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue(5).html" class="nav-link">
    Vue(5)
  </a></li></ul></li><li class="dropdown-item"><h4>
            Vue 手写系列
          </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue-defineReactive.html" class="nav-link">
    Vue 响应式原理
  </a></li><li class="dropdown-subitem"><a href="/plugin/frontend/note/Vue-template.html" class="nav-link">
    Vue 模板编译
  </a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow down"></span></button> <button type="button" aria-label="小程序" class="mobile-dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/plugin/weChat/Pitaya-Hut.html" class="nav-link">
    Pitaya Hut
  </a></li></ul></div></div><div class="nav-item"><a href="https://github.com/ox4f5da2" target="_blank" rel="noopener noreferrer" class="nav-link external">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/plugin/作者的话.html" class="sidebar-link">作者的话</a></li><li><a href="/plugin/Chrome插件.html" class="sidebar-link">Chrome插件</a></li><li><a href="/plugin/脚手架工具开发.html" class="sidebar-link">脚手架工具开发</a></li><li><a href="/plugin/vuepress.html" class="sidebar-link">vuepress快速上手</a></li><li><a href="/plugin/前端笔记.html" class="sidebar-link">前端笔记</a></li><li><a href="/plugin/npm发布流程.html" class="sidebar-link">npm发布流程</a></li><li><a href="/plugin/Leetcode.html" class="sidebar-link">Leetcode</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器知识"><a href="#浏览器知识" class="header-anchor">#</a> 浏览器知识</h1> <p></p><div class="table-of-contents"><ul><li><a href="#宏观视角下的浏览器">宏观视角下的浏览器</a></li><li><a href="#进程和线程">进程和线程</a><ul><li><a href="#进程">进程</a></li><li><a href="#线程">线程</a></li><li><a href="#页面启动时启动的进程">页面启动时启动的进程</a></li></ul></li><li><a href="#计算机网络的七层模型简单介绍">计算机网络的七层模型简单介绍</a></li><li><a href="#udp和tcp">UDP和TCP</a><ul><li><a href="#udp">UDP</a></li><li><a href="#tcp">TCP</a></li></ul></li><li><a href="#http的请求流程">HTTP的请求流程</a><ul><li><a href="#一、构造请求">一、构造请求</a></li><li><a href="#二、查找缓存">二、查找缓存</a></li><li><a href="#三、准备ip地址和端口">三、准备IP地址和端口</a></li><li><a href="#四、等待tcp队列">四、等待TCP队列</a></li><li><a href="#五、建立tcp连接">五、建立TCP连接</a></li><li><a href="#六、发送http请求">六、发送HTTP请求</a></li></ul></li><li><a href="#服务端处理http请求流程">服务端处理HTTP请求流程</a><ul><li><a href="#一、返回请求">一、返回请求</a></li><li><a href="#二、断开连接">二、断开连接</a></li></ul></li><li><a href="#站点第二次打开会很快的原因">站点第二次打开会很快的原因</a></li><li><a href="#浏览器的渲染流程">浏览器的渲染流程</a><ul><li><a href="#一、构建dom树">一、构建DOM树</a></li><li><a href="#二、样式计算-recalculate-style">二、样式计算(Recalculate Style)</a></li><li><a href="#三、布局阶段">三、布局阶段</a></li><li><a href="#四、分层-图层树">四、分层 (图层树)</a></li><li><a href="#五、图层的绘制">五、图层的绘制</a></li><li><a href="#六、栅格化操作">六、栅格化操作</a></li><li><a href="#七、合成和显示">七、合成和显示</a></li><li><a href="#八、渲染流水线总结">八、渲染流水线总结</a></li></ul></li><li><a href="#相关概念">相关概念</a><ul><li><a href="#重排">重排</a></li><li><a href="#重绘">重绘</a></li><li><a href="#直接合成阶段">直接合成阶段</a></li></ul></li></ul></div><p></p> <h2 id="宏观视角下的浏览器"><a href="#宏观视角下的浏览器" class="header-anchor">#</a> 宏观视角下的浏览器</h2> <p>主要分为两大类：</p> <ul><li><code>c/s</code>架构：client -- server</li> <li><code>b/s</code>架构：browser -- server</li></ul> <h2 id="进程和线程"><a href="#进程和线程" class="header-anchor">#</a> 进程和线程</h2> <h3 id="进程"><a href="#进程" class="header-anchor">#</a> 进程</h3> <p><code>进程</code>：就是在内存中正在运行的应用程序</p> <p>进程的特点：</p> <ul><li>在内存中独占一个内存空间</li> <li>进程和进程之间是相互隔离的</li></ul> <div class="custom-block tip"><p class="custom-block-title">进程</p> <p>计算机上正在运行的一个应用程序就是一个进程，如微信正在运行,就是一个进程。正在运行的，也就是说进程是一个动态概念，必须是正在运行的某个应用程序才能称得上是进程。</p></div> <h3 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h3> <p><code>线程</code>：就是进程的最小执行单位</p> <p>线程的特点：</p> <ul><li>一个进程是由多个线程组成的</li> <li>每一个线程之间也是相互隔离的</li></ul> <div class="custom-block tip"><p class="custom-block-title">小结</p> <ul><li>线程是进程的基本单位，一个进程由<strong>一个或者多个线程</strong>组成，搞清楚这个关系之后，我们可以明确线程就是程序执行的<strong>最小单元</strong>。</li> <li>线程和进程一样，也是动态概念，有创建有销毁，存在只是<strong>暂时</strong>的，不是永久性的。</li> <li>进程与线程的区别在于进程在运行时拥有<strong>独立的内存空间</strong>，也就是说每个进程所占用的内存都是独立的</li></ul> <p>例如:微信运行时,系统会给它一个运行内存。</p> <ul><li><strong>多个线程是共享内存空间的</strong>，但是每个线程的<strong>执行是相互独立的</strong>，线程必须依赖于进程才能执行，单独的线程是无法执行的，由进程来控制多个线程的执行，没有进程就不存在线程。</li></ul></div> <h3 id="页面启动时启动的进程"><a href="#页面启动时启动的进程" class="header-anchor">#</a> 页面启动时启动的进程</h3> <p>最少启动了4个进程</p> <ul><li><strong>浏览器进程。</strong> 主要负责界面显示、用户交互、子进程管理、同时提供存储等功能。</li> <li><strong>渲染进程。</strong> 核心任务是将HTML、CSS和JavaScript<strong>转换</strong>为<strong>用户可以与之交互的网页</strong>，排版引擎Blink和JavaScript引擎V8都运行在该进程中，默认情况下，Chrome为每一个Tab标签页创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下的。</li> <li><strong>GPU进程。</strong> GPU图形处理器（英语：graphics processing unit，缩写：<em>GPU</em>）,负责3D css效果，网页，Chrome ui的绘制。</li> <li><strong>网络进程。</strong> 主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立处理，成为单独一个进程。</li> <li><strong>插件进程。</strong> 主要负责插件的运行，因为插件易崩溃，所以通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</li></ul> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/1625035099028.png" alt="1625035099028.png" title="1625035099028.png" class="normal hidden" data-v-77db8a9a></div> <h2 id="计算机网络的七层模型简单介绍"><a href="#计算机网络的七层模型简单介绍" class="header-anchor">#</a> 计算机网络的七层模型简单介绍</h2> <ul><li><strong>物理层：</strong> 使用一定的物理介质（光纤、网线）进行0和1的形式传输</li> <li><strong>数据链路层：</strong> MAC地址，对byte的封装</li> <li><strong>网络层：</strong> IP地址</li> <li><strong>传输层：</strong> UDP（用户数据包协议）、TCP（传输控制协议）</li></ul> <div class="custom-block tip"><p class="custom-block-title">UDP和TCP</p> <p><code>UDP</code>：只管发不管收，比如DNS、微信电话、流媒体</p> <p><code>TCP</code>：如果收方不回复确认消息，那么会进行<strong>重传</strong>，同时根据数据包编号进行<strong>排序后重组</strong></p></div> <ul><li><strong>会话层：</strong> 断点续传</li> <li><strong>表示层：</strong> 翻译，解决不同系统之间数据传输的问题</li> <li><strong>应用层：</strong> HTTP协议</li></ul> <h2 id="udp和tcp"><a href="#udp和tcp" class="header-anchor">#</a> UDP和TCP</h2> <p>IP是非常底层的协议，只负责发送数据包给对方电脑，但对象电脑并不知道把数据包给哪个应用程序，因此，需要基于IP之上能和应用打交道的协议，常用两种协议的UDP(用户数据包协议)和TCP（传输控制协议）协议。</p> <h3 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h3> <p>UDP中最重要的一个信息就是端口号，端口号就是一个数字，每一个想要访问网络的程序都需要绑定一个端口号。通过UDP就能把指定的数据包发送给指定的程序了。<strong>所以IP是通过IP地址将数据包发送给指定的电脑，而UDP是通过端口把数据包分发给了正确的应用。</strong></p> <p>和IP头一样，端口号会被封装进UDP头里面，UDP头和原始数据包合并组成新的UPD数据包，udp头中除了目的端口，还有源端口号等信息。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/02.png" alt="02.png" title="02.png" class="normal hidden" data-v-77db8a9a></div> <div class="custom-block tip"><p class="custom-block-title">数据包从A 到 B 的路线</p> <ol><li>上层将数据包交给传输层</li> <li>传输层会在数据包前面附加上 UDP 头，组成新的 UDP 数据包，再将新的 UDP 数据包交给网络层</li> <li>网络层再将 IP 头附加到数据包上，组成新的 IP 数据包，并交给底层</li> <li>数据包被传输到主机 B 的网络层，在这里主机 B 拆开 IP 头信息，并将拆开来的数据部分交给传输层</li> <li>在传输层，数据包中的 UDP 头会被拆开，并根据 UDP 中所提供的端口号，把数据部分交给上层的应用
程序</li> <li>最终，含有“API”信息的数据包就旅行到了主机 B 上层应用程序这里</li></ol></div> <p>在使用 UDP 发送数据时，有各种因素会导致数据包出错，虽然 UDP 可以校验数据是否正确，但是对于错误的数据包，UDP 并不提供重发机制，只是丢弃当前的包，而且 UDP 在发送之后也无法知道是否能达到目的地。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p><strong>UDP协议只管发送，不管数据是否正确可靠的送达。</strong> 虽说 UDP 不能保证数据可靠性，但是传输速度却非常快，所以 UDP 会应用在一些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等。</p></div> <h3 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h3> <p>对于浏览器请求，或者邮件这类要求数据传输可靠性（reliability）的应用，如果使用 UDP 来传输会存在两个问题：</p> <ul><li>数据包在传输过程中<strong>容易丢失</strong>；</li> <li>大文件会被拆分成很多小的数据包来传输，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而 UDP 协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件，<strong>不能保证大文件数据的完整性。</strong></li></ul> <p>基于这两个问题引入<strong>TCP</strong>。TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。相对于 UDP，TCP 有下面两个特点:</p> <ul><li>对于数据包丢失的情况，TCP 提供<strong>重传机制</strong>；</li> <li>TCP 引入了<strong>数据包排序机制</strong>，用来保证把乱<strong>序的数据包组合成一个完整的文件</strong>。</li></ul> <p>和 UDP 头一样，TCP 头除了包含了目标端口和本机端口号外，还提供了用于排序的序列号，以便接收端通过序号来重排数据包。下面是TCP 下的单个数据包的传输流程：</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/03.png" alt="03.png" title="03.png" class="normal hidden" data-v-77db8a9a></div> <p>通过上图可以看到TCP单个数据包的传输流程和UDP的流程差不多，不同的地方在于，通过TCP头的信息保证了一块大的数据传输的完整性。</p> <p>在传输数据阶段，<strong>接收端需要对每个数据包进行确认</strong>，<strong>给发送端以反馈</strong>。倘若在规定时间内，发送端没有接收到接收端反馈的信息，则判断为数据丢失。<strong>触发重传机制</strong>。</p> <p>同样一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照TCP头部中的序号对其排序，从而<strong>保证数据的完整性</strong>。</p> <p>TCP为了保证数据传输的可靠性，牺牲了数据包的传输速度。</p> <div class="custom-block tip"><p class="custom-block-title">总结</p> <ul><li>互联网中的数据是通过数据包来传输的，数据包在传入过程中容易丢失和出错。</li> <li>IP负责把数据包传递到目的主机</li> <li>UDP负责把数据包送达具体应用</li> <li>而TCP保证了数据完整地传输</li></ul></div> <h2 id="http的请求流程"><a href="#http的请求流程" class="header-anchor">#</a> HTTP的请求流程</h2> <h3 id="一、构造请求"><a href="#一、构造请求" class="header-anchor">#</a> 一、构造请求</h3> <p>首先，浏览器构造请求行，信息如下  构建好之后，浏览器准备发起网络请求</p> <h3 id="二、查找缓存"><a href="#二、查找缓存" class="header-anchor">#</a> 二、查找缓存</h3> <p>在正在发起网络请求之前，浏览器会现在浏览器缓存中查询是否有请求的文件，其实<strong>浏览器缓存是一种本地保存的资源副本，以供下次请求时直接使用的技术。</strong></p> <p>当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求。而不会再去源服务器中重新下载。这样做的好处:</p> <ul><li>缓解服务的压力，提升性能</li></ul> <p>如果缓存查找失败，则进入网络请求。</p> <div class="custom-block tip"><p class="custom-block-title">一句话总结</p> <p>有缓存则取缓存，没有缓存则发送网络请求</p></div> <h3 id="三、准备ip地址和端口"><a href="#三、准备ip地址和端口" class="header-anchor">#</a> 三、准备IP地址和端口</h3> <p>HTTP和TCP的关系，因为浏览器使用HTTP协议作为应用层协议**，用来封装请求的文本信息**；并使用TCP/IP作传输层协议将它发到网络上，所以在HTTP工作开始之前，浏览器需要TCP与服务器建立连接。也就是说HTTP的内容是通过TCP的传输数据阶段来实现的。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/05.png" alt="05.png" title="05.png" class="normal hidden" data-v-77db8a9a></div> <h3 id="四、等待tcp队列"><a href="#四、等待tcp队列" class="header-anchor">#</a> 四、等待TCP队列</h3> <p>IP地址和端口已经准备好了，不可以马上建立TCP连接。因为Chrome有个机制，同一个域名同时最多只能建立6个TCP连接。如果请求书少于6个，直接进入下一步，建立TCP连接。</p> <h3 id="五、建立tcp连接"><a href="#五、建立tcp连接" class="header-anchor">#</a> 五、建立TCP连接</h3> <p>排队等待结束后，建立TCP连接</p> <h3 id="六、发送http请求"><a href="#六、发送http请求" class="header-anchor">#</a> 六、发送HTTP请求</h3> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/06.png" alt="06.png" title="06.png" class="normal hidden" data-v-77db8a9a></div> <h2 id="服务端处理http请求流程"><a href="#服务端处理http请求流程" class="header-anchor">#</a> 服务端处理HTTP请求流程</h2> <h3 id="一、返回请求"><a href="#一、返回请求" class="header-anchor">#</a> 一、返回请求</h3> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/07.png" alt="07.png" title="07.png" class="normal hidden" data-v-77db8a9a></div> <h3 id="二、断开连接"><a href="#二、断开连接" class="header-anchor">#</a> 二、断开连接</h3> <p>通常情况下，一旦服务器向可短返回了请求数据，它就要关闭TCP连接。不过如果在浏览器或服务器在其头部信息加入如下信息：</p> <div class="language- extra-class"><pre class="language-text"><code>Connection:Keep-Alive
</code></pre></div><p>那么TCP连接在发送后将仍然保持打开状态，这样浏览器可以继续通过同一个TCP连接发送请求。保持TCP连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。比如一个Web页面中内嵌图片来自于同一个web站点，如果初始化长连接，就不需要重复建立新的TCP连接。</p> <h2 id="站点第二次打开会很快的原因"><a href="#站点第二次打开会很快的原因" class="header-anchor">#</a> 站点第二次打开会很快的原因</h2> <p>因为在加载页面的过程中，缓存了一些耗时的数据。比如<strong>DNS缓存</strong>和<strong>页面资源缓存</strong>这两块数据是会被浏览器缓存的。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/08.png" alt="08.png" title="08.png" class="normal hidden" data-v-77db8a9a></div> <p>通过上图第一次请求可以看出，当服务器返回HTTP响应头给浏览器时，浏览器通过响应头的<strong>Cache-Control</strong>字段来设置是否缓存该资源。</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control:Max-age=2000 //缓存过期时间是2000
</code></pre></div><p>这也就意味着，在该缓存资源还没有过期的情况下，如果再次发送请求该资源，会之间返回缓存中的资源给浏览器。</p> <p>但如果缓存过期了，浏览器则会继续发送网络请求，并且在HTTP请求头中带上:</p> <div class="language- extra-class"><pre class="language-text"><code>If-None-Match:&quot;xxxxxx&quot;
</code></pre></div><p>简要来说，很多网站第二次访问能够秒开，是因为这些网站把很多资源都缓存在了本地，浏览器缓存直接使用本地副本来回应请求，而不会产生真实的网络请求，从而节省了时间。同时，DNS 数据也被浏览器缓存了，这又省去了 DNS 查询环节。</p> <h2 id="浏览器的渲染流程"><a href="#浏览器的渲染流程" class="header-anchor">#</a> 浏览器的渲染流程</h2> <h3 id="一、构建dom树"><a href="#一、构建dom树" class="header-anchor">#</a> 一、构建DOM树</h3> <p>DOM解析的特点，是不会被阻塞的。因为浏览器无法直接理解和使用HTML，所以需要将HTML转化为浏览器能够理解的结构——<strong>DOM树</strong>。DOM树<strong>输入内容</strong>就是一个简单的HTML页面，然后经过HTML解析器，最终<strong>输出</strong>树状结构的DOM。<strong>document</strong>就是DOM结构，DOM和HTML的内容几乎是一样的，但是和HTML不同的是，DOM是<strong>保存在内存</strong>中的树状结构，可以通过JavaScript来进行查询和修改内容。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/09.png" alt="09.png" title="09.png" class="normal hidden" data-v-77db8a9a></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以在控制台输入<code>document</code>查看输出</p></div> <h3 id="二、样式计算-recalculate-style"><a href="#二、样式计算-recalculate-style" class="header-anchor">#</a> 二、样式计算(Recalculate Style)</h3> <p>样式计算的目的是为了计算出DOM节点中每一个元素的具体样式，这个阶段大体分三步：</p> <h4 id="_1、把css转换为浏览器内容理解的结构"><a href="#_1、把css转换为浏览器内容理解的结构" class="header-anchor">#</a> 1、把css转换为浏览器内容理解的结构</h4> <p>css样式的主要来源有：</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/10.png" alt="10.png" title="10.png" class="normal hidden" data-v-77db8a9a></div> <div class="custom-block tip"><p class="custom-block-title">css样式的来源</p> <p>内联样式，内部样式表，外部样式表</p></div> <p>和HTML文件一样，浏览器也是无法直接理解这些纯文本的CSS样式，所以**当渲染引擎接收到CSS文本的时，会执行一个转换操作，将css文本转换为浏览器可以理解的结构——styleSheets。**渲染引擎会把获取到的 CSS 文本全部转换为 styleSheets 结构中的数据，并且该结构同时具备了查询和修改功能，这会为后面使用JS的样式操作提供基础。</p> <h4 id="_2、转换样式表中的属性值-使其标准化"><a href="#_2、转换样式表中的属性值-使其标准化" class="header-anchor">#</a> 2、转换样式表中的属性值，使其标准化</h4> <p>比如下方所示的CSS样式：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 2em <span class="token punctuation">}</span>
<span class="token selector">p</span> <span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span>blue<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">span</span> <span class="token punctuation">{</span><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">}</span>
<span class="token selector">div</span> <span class="token punctuation">{</span><span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">}</span>
<span class="token selector">div p</span> <span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span>green<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">div</span> <span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>标准化后转变为如下的样式：</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/11.png" alt="11.png" title="11.png" class="normal hidden" data-v-77db8a9a></div> <div class="custom-block tip"><p class="custom-block-title">属性值标准化</p> <p>CSS 文本中有很多属性值，如 2em、blue、bold，这些类型数值不容易被渲染引擎理解，所以需要将所有值转换为渲染引擎容易理解的、标准化的计算值，这个过程就是属性值标准化。</p></div> <h4 id="_3、计算出dom树中每一个节点的具体样式"><a href="#_3、计算出dom树中每一个节点的具体样式" class="header-anchor">#</a> 3、计算出DOM树中每一个节点的具体样式</h4> <p>首先是css的继承，<strong>css继承是每个DOM节点都包含父节点的样式</strong>。总之，样式计算阶段的目的是为了计算出 DOM 节点中每个元素的具体样式，在计算过程中需要遵守 CSS 的继承和层叠两个规则。这个阶段最终输出的内容是每个 DOM 节点的样式，并被保存在 ComputedStyle 的结构内。</p> <div class="custom-block tip"><p class="custom-block-title">继承和层叠</p> <p><strong>继承规则</strong>就是一般文本和字体相关样式都是可以继承的。<strong>层叠规则</strong>，嵌套的越深权重就越高。</p></div> <div class="custom-block tip"><p class="custom-block-title">计算样式的结果展示</p> <p>如果想了解每个 DOM 元素最终的计算样式，可以打开 Chrome 的“开发者工具”，选择第一个“element”标签，然后再选择“Computed”子标签</p></div> <h3 id="三、布局阶段"><a href="#三、布局阶段" class="header-anchor">#</a> 三、布局阶段</h3> <p>现在生成了DOM树和DOM树中元素的样式，但是还不足以显示页面，因为还不知道DOM元素的几何位置，那么接下来就需要<strong>计算出DOM树中可见元素的几何位置，通常把这个计算过程叫做布局</strong>。Chrome在布局阶段需要完成两个任务：<strong>创建布局树</strong>和<strong>布局计算</strong>。</p> <h4 id="_1、创建布局树"><a href="#_1、创建布局树" class="header-anchor">#</a> 1、创建布局树</h4> <p>DOM树有些元素不会在页面上显示，被用户看到，如head标签和使用了display:none的元素。所以在显示之前，还要额外地构建一棵<strong>只包含了可见元素的布局树</strong>。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/12.png" alt="12.png" title="12.png" class="normal hidden" data-v-77db8a9a></div> <blockquote><p>从上图可以看出，DOM树中所有不可见的节点都没有有包含到布局树中。</p></blockquote> <h4 id="_2、布局计算"><a href="#_2、布局计算" class="header-anchor">#</a> 2、布局计算</h4> <p>当已经有了一棵完整的布局树，那么接下来就要根据DOM节点对应的css树中的样式，计算布局树节点的坐标位置。</p> <blockquote><p>也就是计算元素在视口上确切的位置和大小。</p></blockquote> <h3 id="四、分层-图层树"><a href="#四、分层-图层树" class="header-anchor">#</a> 四、分层 (图层树)</h3> <p>有了布局树之后，每个元素的具体位置信息都计算出来了，还是不能着手绘制页面，因为页面中有很多复杂的效果，如一些<code>复杂的3D转换</code>，<code>页面滚动</code>，或者使用<code>z-index</code>，为了更方便的实现这些效果，<strong>渲染引擎还需要为特定的节点生成专门的图层，并生成一棵对应的图层树(LayerTree)</strong>。这和PS的图层类似，正是这些图层叠加在一起才最终构成了页面图像。</p> <div class="custom-block tip"><p class="custom-block-title">展示layer层</p> <p>想要直观的理解什么是图层，可以打开Chrome的&quot;开发工具&quot;，选择Layers标签，就可以查看可视化页面的分层情况</p></div> <p><strong>实际上，浏览器的页面被分成了很多图层，这些图层叠加在一起后，最终合成了页面。</strong></p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/04.png" alt="04.png" title="04.png" class="normal hidden" data-v-77db8a9a></div> <p>满足以下两个条件中的任意一个，元素就可以被单独提升为一个图层，渲染引擎才会为特定的节点创建新的图层：</p> <h4 id="_1、拥有层叠上下文属性的元素会被提升为单独的一层"><a href="#_1、拥有层叠上下文属性的元素会被提升为单独的一层" class="header-anchor">#</a> 1、拥有层叠上下文属性的元素会被提升为单独的一层</h4> <div class="language- extra-class"><pre class="language-text"><code>1、position:fixed
2、css 3d   例如:transform:rotateX(30deg)
3、video
4、canvas
5、有css3动画的节点
</code></pre></div><h4 id="_2、需要剪裁的地方也会被创建为图层"><a href="#_2、需要剪裁的地方也会被创建为图层" class="header-anchor">#</a> 2、需要剪裁的地方也会被创建为图层</h4> <blockquote><p>文字内容溢出div的情况</p></blockquote> <p>比如如下例子🌰：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">div</span> <span class="token punctuation">{</span>
              <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
              <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
              <span class="token property">overflow</span><span class="token punctuation">:</span>auto<span class="token punctuation">;</span>
              <span class="token property">background</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> 
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>所以元素有了层叠上下文的属性或者需要被剪裁，那么就会被提升成为单独一层，你可以参看下图：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>从上图我们可以看到，document层上有A和B层，而B层之上又有两个图层。这些图层组织在一起也是一颗树状结构。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>图层树是基于布局树来创建的，为了找出哪些元素需要在哪些层中，渲染引擎会遍历布局树来创建层树（Update LayerTree）。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里我么把div的大小限定为<code>200 * 200</code>像素，而div里面的文字内容比较多，文字所显示的区域肯定会超过<code>200 * 200</code>的面积，这时候就产生了<strong>剪裁</strong>，渲染引擎会把裁剪文字内容的一部分用于显示在div区域，下面是运行时的执行结果：</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/01.png" alt="01.png" title="01.png" class="normal hidden" data-v-77db8a9a></div> <div class="custom-block tip"><p class="custom-block-title">小提示💡</p> <p>出现这种裁剪情况时，渲染引擎会为文字单独为文字创建一层，如出现滚动条，滚动条也会被提升为单独的层。</p></div> <h3 id="五、图层的绘制"><a href="#五、图层的绘制" class="header-anchor">#</a> 五、图层的绘制</h3> <p>渲染引擎实现图层的绘制与画画类似，会把一个图层的绘制拆分为很多小的绘制指令，然后再把这些指令按照顺序组成一个待绘制列表，如下图所示:</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/13.png" alt="13.png" title="13.png" class="normal hidden" data-v-77db8a9a></div> <p>从图中可以看出，绘制列表中的指令其实非常简单，就是让其执行一个简单的绘制操作，比如说绘制粉色矩形或者黑色的线等。而绘制一个元素通常需要好几条绘制指令，因为每个元素的背景、前景、边框都需要单独的指令去绘制。所以在<strong>图层绘制阶段，输出的内容就是这些待绘制列表</strong>。</p> <blockquote><p>这个地方有点类似于真实场景中的画画，不是一笔画成的，而是由画了很多笔而成。</p></blockquote> <h3 id="六、栅格化操作"><a href="#六、栅格化操作" class="header-anchor">#</a> 六、栅格化操作</h3> <p>绘制列表指令用来记录绘制顺序和绘制指令的列表，而实际上<strong>绘制操作是由渲染引擎中的合成线程来完成</strong>。通常一个页面可能很大，用户只能看到其中的一部分，我们把<strong>用户可以看到的这个区域叫视口(viewport)。<strong>比如说，一个图层很大，页面需要滚动底部，才能全部显示。但是通过视口，用户只能看到页面很小的一部分，所以在此种情况下，要一次性绘制完图层所有的内容，会产生很大的开销，且没有必要。基于这个原因，<strong>合成线程会将图层划分为图块(tile),<strong>这些图块的大小通常是<code>256 * 256</code>或<code>512 * 512</code>。然后</strong>合成线程会按照视口附近的图块来优先生成位图</strong>，实际生成位图的操作就是有栅格化来执行的。所谓栅格化，<strong>是指将图块转化为位图(所谓位图就是能够看的到的图层区域)。而图块是栅格化执行的最小单位。<strong>渲染进程维护了一个栅格化的线程池，所有的图块栅格化都是在线程池内执行，通常，栅格化过程都会使用GPU来加速生成，使用GPU生成位图过程叫</strong>快速栅格化</strong>，或者</strong>GPU栅格化</strong>，生成的位图被保存在GPU内存中。GPU操作是运行在GPU进程中的，那么栅格化，还涉及到了跨进程操作。从图中可以看出，渲染进程把生成图块的指令发送给 GPU，然后在 GPU 中执行生成图块的位图，并保存在 GPU 的内存中。</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/14.png" alt="14.png" title="14.png" class="normal hidden" data-v-77db8a9a></div> <h3 id="七、合成和显示"><a href="#七、合成和显示" class="header-anchor">#</a> 七、合成和显示</h3> <p>一旦所有图块被栅格化(又称光栅化)，合成线程就会生成一个绘制图块的命令——<code>DrawQuad</code>，然后将该命令提交给浏览器进程。浏览器进程里有一个叫viz的组件，用来接收合成线程发过来的DrawQuad命令，然后根据DrawQuad命令，将其页面内容绘制到内存中，最后显示在屏幕上。到此，经过一系列的阶段，编写好的HTML、CSS、JavaScript等文件，经过浏览器就会显示为页面。</p> <h3 id="八、渲染流水线总结"><a href="#八、渲染流水线总结" class="header-anchor">#</a> 八、渲染流水线总结</h3> <p>1、渲染进程将HTML内容转换为浏览器能够读懂的<strong>DOM树</strong>结构。</p> <p>2、渲染引擎将CSS样式表转化为浏览器能够理解的<strong>css树</strong>,计算出DOM节点的样式。</p> <p>3、DOM树+css树创建布局树，并计算元素的布局信息。</p> <p>4、对布局树进行分层，并生成<strong>图层树</strong>。</p> <p>5、对每个<strong>图层</strong>生成<strong>绘制列表</strong>，并将其提交给合成线程。</p> <p>6、对每个图层进行单独的绘制</p> <p>7、合并图层。</p> <h2 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h2> <h3 id="重排"><a href="#重排" class="header-anchor">#</a> 重排</h3> <p><code>重排</code>：更新元素的几何属性</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/15.png" alt="15.png" title="15.png" class="normal hidden" data-v-77db8a9a></div> <p>从上图可以看出，如果<strong>通过JS或css修改元素的几何位置属性</strong>，如<code>width</code>、<code>height</code>等，那么会触发浏览器的重新布局，解析之后的一系列子阶段，这个过程就叫<strong>重排</strong>。</p> <div class="custom-block warning"><p class="custom-block-title">小提示💡</p> <p>重排需要更新完整的渲染流水线，所以开销也最大的。</p></div> <h3 id="重绘"><a href="#重绘" class="header-anchor">#</a> 重绘</h3> <p><code>重绘</code>：更细元素的绘制属性</p> <p>比如通过JS更改某些元素的背景颜色，渲染流水的调整参见下图：</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/16.png" alt="16.png" title="16.png" class="normal hidden" data-v-77db8a9a></div> <p>修改元素的背景色，布局阶段不会执行，因为<strong>没有引起几何位置的变换</strong>，所以直接进入绘制，然后执行之后的一系列子阶段，这个过程就叫<strong>重绘</strong>。</p> <div class="custom-block warning"><p class="custom-block-title">小提示💡</p> <p>相较重排操作，重绘省去了布局和分层阶段，所以执行效率会比重排效率高。</p></div> <h3 id="直接合成阶段"><a href="#直接合成阶段" class="header-anchor">#</a> 直接合成阶段</h3> <p><code>合成</code>：那如果你更改一个既不要布局也不要绘制的属性，渲染引擎将跳过布局和绘制，只执行后续的合成操作</p> <div class="myImg origin" data-v-77db8a9a><img data-url="https://fang-6g2x00mca935d11b-1305708135.tcloudbaseapp.com/Karl_Doc_vuepress/images/Img_Chrome/17.png" alt="17.png" title="17.png" class="normal hidden" data-v-77db8a9a></div> <p>在上图，使用CSS的transform来实现动画效果，可以避开重排和重绘阶段，直接在非主线程上执行合成动画操作。这样的效率最高，因为是在非主线程上合成的，并没有占用主线程的资源。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;height:60px;display:none;" data-v-5775ee02>
        欢迎来到 火龙果文档
      </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
      看板娘
    </div></div></div></div>
    <script src="/plugin/assets/js/app.c9215cbb.js" defer></script><script src="/plugin/assets/js/2.3109c390.js" defer></script><script src="/plugin/assets/js/60.f66cea3f.js" defer></script><script src="/plugin/assets/js/4.e3ff3068.js" defer></script>
  </body>
</html>
